<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.5, maximum-scale=3.0">
    <title>Caça-Palavras</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0 auto;
            padding: 15px;
            background-color: #f0f0f0;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: manipulation;
        }
        h1, h2, h3 {
            color: #006400;
            text-align: center;
            margin: 10px 0;
        }
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ccc;
            flex-wrap: wrap;
            justify-content: center;
        }
        .tabs .tab {
            padding: 8px 12px;
            cursor: pointer;
            background: #f1f1f1;
            border: 1px solid #ccc;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin: 0 3px 0 0;
            transition: background-color 0.3s;
        }
        .tabs .tab:hover {
            background: #e0e0e0;
            text-decoration: underline;
        }
        .tabs .tab.active {
            background: #006400;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 15px;
            border: 1px solid #ccc;
            border-top: none;
            background: white;
            border-radius: 0 0 5px 5px;
            width: 100%;
            max-width: 400px;
        }
        .tab-content.active {
            display: block;
        }
        #start-screen, #game-screen, #ranking-screen {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        #start-screen h1, #game-screen h2, #ranking-screen h2 {
            margin-top: 0;
        }
        #player-name {
            padding: 8px;
            margin: 10px 0;
            width: 100%;
            max-width: 200px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #start-button, #music-toggle, #load-game-button, #ranking-button, #restart-button, #end-game-button, #new-words-button, #save-game-button, #load-game-button, #difficulty-buttons button, #zoom-toggle {
            padding: 8px 16px;
            background-color: #006400;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background-color 0.3s;
        }
        #end-game-button {
            background-color: #FF4500;
        }
        #end-game-button:hover {
            background-color: #D83A00;
        }
        #start-button:hover, #music-toggle:hover, #load-game-button:hover, #ranking-button:hover, #restart-button:hover, #new-words-button:hover, #save-game-button:hover, #load-game-button:hover, #difficulty-buttons button:hover, #zoom-toggle:hover {
            background-color: #004d00;
        }
        #start-button:disabled, #difficulty-buttons button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #music-toggle i, #sound-toggle i {
            font-size: 1.2em;
        }
        #music-toggle.off, #sound-toggle.off {
            background-color: #666;
        }
        #game-info {
            margin: 10px 0;
            text-align: left;
        }
        #player-info, #timers {
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        #difficulty-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            margin: 10px 0;
        }
        #difficulty-buttons button {
            flex: 1 1 45%;
            max-width: 150px;
        }
        #word-list {
            margin: 10px 0;
        }
        #word-list select {
            width: 100%;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        #grid {
            display: grid;
            gap: 2px;
            margin: 10px auto;
            width: fit-content;
        }
        .cell {
            width: 30px;
            height: 30px;
            background: #90EE90;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #006400;
            cursor: pointer;
            font-size: 1.1em;
            user-select: none;
            transition: background-color 0.3s;
        }
        .cell:hover {
            background: #70c770;
        }
        .cell.selected {
            background: #FFD700;
        }
        .cell.found {
            background: #4682B4;
            cursor: default;
        }
        .contact-form {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-width: 400px;
            margin: 0 auto;
        }
        .contact-form input, .contact-form textarea {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .contact-form button {
            background-color: #006400;
            color: white;
            border: none;
            padding: 8px;
            cursor: pointer;
            border-radius: 5px;
        }
        .contact-form button:hover {
            background-color: #004d00;
        }
        .social-media, .links-list {
            margin: 15px 0;
        }
        .social-media h3, .links-list h3 {
            color: #006400;
            font-weight: bold;
            margin-bottom: 12px;
        }
        .social-media a, .links-list a {
            text-decoration: none;
            color: #006400;
        }
        .social-media a:hover, .links-list a:hover {
            text-decoration: underline;
        }
        .social-media p, .links-list li {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 8px 0;
        }
        .social-media i, .links-list i {
            color: #006400;
            font-size: 1.1em;
        }
        #ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9em;
        }
        #ranking-table th, #ranking-table td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: center;
        }
        #ranking-table th {
            background-color: #006400;
            color: white;
        }
        .copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9em;
        }
        .copyright a {
            text-decoration: none;
            color: #006400;
            font-weight: bold;
        }
        .copyright a:hover {
            text-decoration: underline;
        }
        #ranking-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        #ranking-modal-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
            width: 90%;
            max-width: 400px;
            position: relative;
        }
        #close-ranking {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 1.2em;
        }
        @media (max-width: 600px) {
            body { padding: 10px; }
            .tab-content, #start-screen, #game-screen, #ranking-screen { padding: 10px; max-width: 350px; }
            .cell { width: 25px; height: 25px; font-size: 0.9em; }
            #difficulty-buttons button { font-size: 0.8em; padding: 6px; }
            #player-name { max-width: 180px; }
            h1 { font-size: 1.5em; }
            h2 { font-size: 1.2em; }
            #ranking-table th, #ranking-table td { padding: 4px; font-size: 0.8em; }
        }
    </style>
</head>
<body>
    <div id="start-screen">
        <h1>Caça-Palavras</h1>
        <label for="player-name">Digite seu nome para iniciar</label>
        <input type="text" id="player-name" placeholder="Seu nome">
        <div>
            <button id="start-button" disabled>Iniciar</button>
            <button id="music-toggle" class="on"><i class="fas fa-volume-up"></i> Som</button>
        </div>
        <div>
            <button id="load-game-button">Carregar Jogo</button>
            <button id="ranking-button">Ranking</button>
        </div>
        <input type="file" id="load-file-input" accept=".json" style="display: none;" onchange="loadGame(event)">
    </div>

    <div id="game-screen" style="display: none;">
        <div class="tabs">
            <div class="tab active" onclick="openTab(event, 'jogo-tab')">Jogo</div>
            <div class="tab" onclick="openTab(event, 'contato-tab')">Contato</div>
            <div class="tab" onclick="openTab(event, 'ekpb-tab')">EKPB Digital Music ©</div>
            <div class="tab" onclick="openTab(event, 'como-jogar-tab')">Como Jogar</div>
            <div class="tab" onclick="openTab(event, 'ranking-tab')">Ranking</div>
            <div class="tab" onclick="openTab(event, 'jogos-tab')">+Jogos</div>
        </div>

        <div id="jogo-tab" class="tab-content active">
            <div>
                <button id="restart-button">Reiniciar Jogo</button>
                <button id="end-game-button">Encerrar Jogo</button>
                <button id="new-words-button">NOVAS PALAVRAS (<span id="new-words-count">2</span>)</button>
            </div>
            <div id="game-info">
                <div id="player-info">Jogador: <span id="player-display">Jogador</span></div>
                <div id="difficulty-buttons">
                    <button id="easy-button">Fácil</button>
                    <button id="medium-button">Médio</button>
                    <button id="hard-button">Difícil</button>
                    <button id="very-hard-button">Muito Difícil</button>
                    <button id="save-game-button">Salvar Jogo</button>
                    <button id="load-game-button">Carregar Jogo</button>
                </div>
                <div id="sound-controls">
                    <button id="music-toggle-game" class="on"><i class="fas fa-volume-up"></i></button>
                    <button id="sound-toggle" class="on"><i class="fas fa-bell"></i></button>
                </div>
                <div id="timers">
                    <div>Tempo Total: <span id="total-time">0.000</span></div>
                    <div>Tempo Palavra: <span id="word-time">60.000</span></div>
                </div>
                <div id="zoom-control">
                    <button id="zoom-toggle">Desativar Zoom</button>
                </div>
                <div id="word-list">
                    <label>Palavras</label>
                    <select id="words-dropdown" size="5"></select>
                </div>
                <div id="grid"></div>
            </div>
        </div>

        <div id="contato-tab" class="tab-content">
            <h2>Contato</h2>
            <div class="contact-form">
                <input type="text" id="contact-name" placeholder="Nome">
                <input type="email" id="contact-email" placeholder="Email">
                <textarea id="contact-message" placeholder="Mensagem" rows="5"></textarea>
                <button onclick="submitContact()">Enviar</button>
            </div>
            <div class="social-media">
                <h3>EKPB Digital Music ©</h3>
                <p><strong>Siga-nos nas Redes Sociais:</strong></p>
                <p><i class="fab fa-instagram"></i> Instagram: <a href="https://instagram.com/ekpbdigitalmusic" target="_blank">@ekpbdigitalmusic</a></p>
                <p><i class="fab fa-youtube"></i> YouTube: <a href="https://youtube.com/@ekpbdigitalmusic" target="_blank">@ekpbdigitalmusic</a></p>
                <p><i class="fab fa-tiktok"></i> TikTok: <a href="https://tiktok.com/@ekpbdigitalmusic" target="_blank">@ekpbdigitalmusic</a></p>
                <p><i class="fas fa-video"></i> Kwai: <a href="https://kwai.com/@ekpbdigitalmusic" target="_blank">@ekpbdigitalmusic</a></p>
                <p><i class="fas fa-envelope"></i> Email: <a href="mailto:ekpbdigitalmusic@gmail.com">ekpbdigitalmusic@gmail.com</a></p>
                <p><strong>Compositor</strong></p>
                <p><i class="fab fa-instagram"></i> Instagram: <a href="https://instagram.com/edsonk.palacio" target="_blank">@edsonk.palacio</a></p>
                <p><i class="fab fa-youtube"></i> YouTube: <a href="https://youtube.com/@edsonkpalacioo" target="_blank">@edsonkpalacioo</a></p>
                <p><i class="fab fa-tiktok"></i> TikTok: <a href="https://tiktok.com/@edsonkpalacio" target="_blank">@edsonkpalacio</a></p>
                <p><i class="fas fa-video"></i> Kwai: <a href="https://kwai.com/@edsonkpalacio" target="_blank">@edsonkpalacio</a></p>
                <p><i class="fas fa-envelope"></i> Email: <a href="mailto:edsonpalacio@gmail.com">edsonpalacio@gmail.com</a></p>
                <p><i class="fab fa-whatsapp"></i> Cel: <a href="https://wa.me/5588996812029" target="_blank">(88) 99681-2029</a></p>
            </div>
        </div>

        <div id="ekpb-tab" class="tab-content">
            <h2>EKPB Digital Music ©</h2>
            <ul class="links-list">
                <li><i class="fab fa-youtube"></i> <a href="https://www.youtube.com/watch?v=AZ0mhfobGDc" target="_blank">Sobre Esta Pedra</a></li>
                <li><i class="fab fa-youtube"></i> <a href="https://www.letras.mus.br/ekpb-digital-music/amor-de-pai-e-filho-grandes-amigos/" target="_blank">Amor de Pai e Filho Grandes Amigos</a></li>
                <li><i class="fab fa-youtube"></i> <a href="https://www.youtube.com/watch?v=nKxcs" target="_blank">Vicent's Churrascaria</a></li>
                <li><i class="fab fa-youtube"></i> <a href="https://www.youtube.com/watch?v=pyAn-MI0spg" target="_blank">Joker Tecnologia</a></li>
                <li><i class="fab fa-youtube"></i> <a href="https://www.youtube.com/watch?v=Csu2ZmEYxjk" target="_blank">Mãe da Igreja Mãe do Amor</a></li>
                <li><i class="fab fa-youtube"></i> <a href="https://www.youtube.com/watch?v=a7QLC03pRug" target="_blank">Kauan Lugar Feito Para Você</a></li>
                <li><i class="fab fa-youtube"></i> <a href="https://www.youtube.com/watch?v=i-11gRpD2iE" target="_blank">Vida Gula - Um HIT No Lar</a></li>
                <li><i class="fab fa-youtube"></i> <a href="https://www.youtube.com/watch?v=O-DbYY9Q6J8" target="_blank">Vida Gula - Um HIT No Lar Hit</a></li>
                <li><i class="fab fa-youtube"></i> <a href="https://www.youtube.com/watch?v=pnodRjA3cYc" target="_blank">Mother of the Church, Mother of Love</a></li>
                <li><i class="fab fa-youtube"></i> <a href="https://www.youtube.com/watch?v=ExRj-zwmnk" target="_blank">Aleatory Family</a></li>
            </ul>
            <div class="social-media">
                <h3>Canais no YouTube</h3>
                <p><i class="fab fa-youtube"></i> <a href="https://youtube.com/@ekpbdigitalmusic" target="_blank">@ekpbdigitalmusic</a></p>
                <p><i class="fab fa-youtube"></i> <a href="https://youtube.com/@edsonkpalacio" target="_blank">@edsonkpalacio</a></p>
                <p><i class="fab fa-youtube"></i> <a href="https://youtube.com/@edsonkpalacioo" target="_blank">@edsonkpalacioo</a></p>
            </div>
        </div>

        <div id="como-jogar-tab" class="tab-content">
            <h2>Como Jogar</h2>
            <p>Bem-vindo(a) ao Jogo Caça-Palavras! Este jogo é simples e divertido, projetado para testar sua habilidade de encontrar palavras. Abaixo, você encontrará todas as instruções para jogar:</p>
            <h3>Instruções</h3>
            <ul>
                <li><strong>Iniciar o Jogo:</strong>
                    <ul>
                        <li>Digite seu nome na tela inicial e clique em "Iniciar".</li>
                        <li>Escolha um nível de dificuldade (Fácil, Médio, Difícil ou Muito Difícil) para começar o jogo. Você deve selecionar um modo antes de interagir com as letras do grid, ou uma mensagem será exibida.</li>
                        <li>Antes de iniciar, você pode clicar em "NOVAS PALAVRAS" até 2 vezes para alterar a lista de palavras (mantendo EDSON, PAINHO, SAUDADES e JOAQUIM).</li>
                        <li>Após escolher o nível, os botões de dificuldade serão desativados até que você reinicie o jogo.</li>
                    </ul>
                </li>
                <li><strong>Objetivo:</strong>
                    <ul>
                        <li>Encontre todas as palavras listadas no grid de letras dentro do tempo limite por palavra.</li>
                        <li>As palavras estão listadas acima do grid em uma lista suspensa.</li>
                    </ul>
                </li>
                <li><strong>Passo a Passo:</strong>
                    <ul>
                        <li>Clique ou toque na primeira letra de uma palavra e, em seguida, clique ou toque na última letra da mesma palavra para selecioná-la.</li>
                        <li>As palavras podem estar na horizontal, vertical, diagonal, e podem estar invertidas (de trás para frente).</li>
                        <li>Quando uma palavra for encontrada, ela será destacada no grid (em azul) e marcada na lista com um traço no meio.</li>
                        <li>Continue até encontrar todas as palavras do nível atual.</li>
                    </ul>
                </li>
                <li><strong>Tempo:</strong>
                    <ul>
                        <li><strong>Tempo Total:</strong> Conta o tempo total do jogo, desde o início até encontrar todas as palavras ou o jogo terminar.</li>
                        <li><strong>Tempo Palavra:</strong> Você tem 1 minuto (60 segundos) para encontrar cada palavra. Cada vez que encontrar uma palavra, o tempo de 1 minuto é reiniciado. Se o tempo acabar, o jogo termina com "Game Over".</li>
                    </ul>
                </li>
                <li><strong>Níveis:</strong>
                    <ul>
                        <li><strong>Fácil:</strong> Grid 10x10, 8 palavras.</li>
                        <li><strong>Médio:</strong> Grid 9x9, 8 palavras.</li>
                        <li><strong>Difícil:</strong> Grid 12x12, 10 palavras.</li>
                        <li><strong>Muito Difícil:</strong> Grid 15x15, 12 palavras.</li>
                    </ul>
                </li>
                <li><strong>Reiniciar Jogo:</strong>
                    <ul>
                        <li>Clique em "Reiniciar Jogo" para voltar à tela inicial.</li>
                        <li>Ao reiniciar, sua pontuação (tempo total e palavras encontradas) será zerada, e você será solicitado a digitar seu nome novamente.</li>
                        <li>As palavras serão misturadas (mantendo EDSON, PAINHO, SAUDADES e JOAQUIM), e os botões de nível serão reativados, permitindo escolher um novo modo.</li>
                    </ul>
                </li>
                <li><strong>Encerrar Jogo:</strong>
                    <ul>
                        <li>Clique em "Encerrar Jogo" para desistir. Seu tempo total e palavras encontradas serão registrados no ranking com o status "Desistido".</li>
                    </ul>
                </li>
                <li><strong>Controles de Áudio:</strong>
                    <ul>
                        <li><strong>Música de Fundo:</strong> Use o botão de música (ícone de volume) para ligar/desligar a música de fundo. Na tela inicial, o botão "Som" também controla a música.</li>
                        <li><strong>Sons do Jogo:</strong> Use o botão de sons (ícone de sino) para ligar/desligar os sons de interação (clique, acerto, erro, game over, vitória).</li>
                    </ul>
                </li>
                <li><strong>Zoom (Dispositivos Móveis):</strong>
                    <ul>
                        <li>Em dispositivos móveis, um botão "Desativar Zoom" aparece. Use-o para ativar/desativar o zoom da página, facilitando a interação com o grid.</li>
                    </ul>
                </li>
                <li><strong>Salvar e Carregar Jogo:</strong>
                    <ul>
                        <li><strong>Salvar Jogo:</strong> Clique em "Salvar Jogo" para baixar um arquivo JSON com o estado atual do jogo (grid, palavras encontradas, tempo, etc.).</li>
                        <li><strong>Carregar Jogo:</strong> Clique em "Carregar Jogo" para abrir uma janela de seleção de arquivo e carregar um jogo salvo anteriormente.</li>
                    </ul>
                </li>
                <li><strong>Ranking:</strong>
                    <ul>
                        <li>Seu desempenho é salvo no ranking quando você vence o jogo (encontra todas as palavras) ou desiste.</li>
                        <li>O ranking é ordenado pela quantidade de palavras encontradas (maior primeiro) e, em caso de empate, pelo tempo total (menor primeiro).</li>
                        <li>Você pode ver o ranking na tela inicial (botão "Ranking") ou na aba "Ranking" dentro do jogo.</li>
                    </ul>
                </li>
                <li><strong>Condições de Vitória e Derrota:</strong>
                    <ul>
                        <li><strong>Vitória:</strong> Encontre todas as palavras do nível. Você verá uma mensagem de parabéns com o tempo total, sua pontuação será salva no ranking, e o jogo será reiniciado no mesmo nível.</li>
                        <li><strong>Derrota:</strong> Se o tempo por palavra (1 minuto) acabar, o jogo termina com "Game Over", e você será levado de volta à tela inicial.</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div id="ranking-tab" class="tab-content">
            <h2>Ranking</h2>
            <table id="ranking-table-game">
                <thead>
                    <tr>
                        <th>Posição</th>
                        <th>Jogador</th>
                        <th>Nível</th>
                        <th>Palavras</th>
                        <th>Tempo</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="ranking-list-game"></tbody>
            </table>
        </div>

        <div id="jogos-tab" class="tab-content">
            <h2>+Jogos</h2>
            <ul class="links-list">
                <li><i class="fas fa-gamepad"></i> <a href="https://ekpb-cyborg.github.io/JEPP-GAME-MEMORIA/" target="_blank">Jogo da Memória</a></li>
            </ul>
        </div>

        <div class="copyright">
            Technology EKPB Digital Music © | Powered by <a href="https://ekpbdigitalmusic.my.canva.site/" target="_blank">Edson Palácio</a>
        </div>
    </div>

    <div id="ranking-modal">
        <div id="ranking-modal-content">
            <h2>Ranking</h2>
            <table id="ranking-table-modal">
                <thead>
                    <tr>
                        <th>Posição</th>
                        <th>Jogador</th>
                        <th>Nível</th>
                        <th>Palavras</th>
                        <th>Tempo</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="ranking-list-modal"></tbody>
            </table>
            <span id="close-ranking" onclick="closeRankingModal()">Fechar</span>
        </div>
    </div>

    <script>
        const config = {
            levels: {
                easy: { gridSize: 10, numWords: 8 },
                medium: { gridSize: 9, numWords: 8 },
                hard: { gridSize: 12, numWords: 10 },
                veryHard: { gridSize: 15, numWords: 12 }
            },
            baseWords: ['EDSON', 'PAINHO', 'SAUDADES', 'JOAQUIM'],
            additionalWords: [
                'AMOR', 'FAMILIA', 'FELICIDADE', 'PAZ', 'SONHO', 'ALEGRIA',
                'CAMINHO', 'LUZ', 'ESPERANCA', 'CORAGEM', 'FORCA', 'SABEDORIA',
                'UNIAO', 'GRATIDAO', 'BONDADE', 'VERDADE', 'HARMONIA', 'POESIA'
            ],
            sounds: {
                click: '/aud/click.mp3',
                hover: '/aud/botaos/hover.mp3',
                type: '/aud/type.mp3',
                start: '/aud/start.mp3',
                success: '/aud/aplausos.mp3', // Alterado de 'success.mp3' para 'aplausos.mp3'
                error: '/aud/error.mp3',
                gameOver: '/aud/game-over.mp3',
                win: '/aud/win.mp3'
            },
            music: {
                musical1: '/aud/musical1.mp3',
                musical2: '/aud/musical2.mp3'
            }
        };

        let state = {
            playerName: '',
            level: null,
            grid: [],
            words: [],
            foundWords: new Set(),
            selectedCells: [],
            totalTime: 0,
            wordTime: 60000,
            gameStarted: false,
            timerInterval: null,
            wordTimerInterval: null,
            newWordsCount: 2,
            ranking: [],
            musicOn: true,
            soundOn: true,
            musicAudio: null,
            currentMusic: 'musical1', // Rastreia qual música está tocando
            audioUnlocked: false
        };

        const audio = {
            click: new Audio(config.sounds.click),
            hover: new Audio(config.sounds.hover),
            type: new Audio(config.sounds.type),
            start: new Audio(config.sounds.start),
            success: new Audio(config.sounds.success),
            error: new Audio(config.sounds.error),
            gameOver: new Audio(config.sounds.gameOver),
            win: new Audio(config.sounds.win)
        };

        Object.values(audio).forEach(a => {
            a.volume = 0.5;
            a.loop = false;
        });

        const dom = {
            startScreen: document.getElementById('start-screen'),
            gameScreen: document.getElementById('game-screen'),
            playerNameInput: document.getElementById('player-name'),
            startButton: document.getElementById('start-button'),
            musicToggle: document.getElementById('music-toggle'),
            musicToggleGame: document.getElementById('music-toggle-game'),
            soundToggle: document.getElementById('sound-toggle'),
            loadGameButton: document.getElementById('load-game-button'),
            rankingButton: document.getElementById('ranking-button'),
            loadFileInput: document.getElementById('load-file-input'),
            restartButton: document.getElementById('restart-button'),
            endGameButton: document.getElementById('end-game-button'),
            newWordsButton: document.getElementById('new-words-button'),
            newWordsCount: document.getElementById('new-words-count'),
            playerDisplay: document.getElementById('player-display'),
            easyButton: document.getElementById('easy-button'),
            mediumButton: document.getElementById('medium-button'),
            hardButton: document.getElementById('hard-button'),
            veryHardButton: document.getElementById('very-hard-button'),
            saveGameButton: document.getElementById('save-game-button'),
            loadGameButtonGame: document.getElementById('load-game-button'),
            totalTime: document.getElementById('total-time'),
            wordTime: document.getElementById('word-time'),
            zoomToggle: document.getElementById('zoom-toggle'),
            wordsDropdown: document.getElementById('words-dropdown'),
            grid: document.getElementById('grid'),
            rankingListGame: document.getElementById('ranking-list-game'),
            rankingModal: document.getElementById('ranking-modal'),
            rankingListModal: document.getElementById('ranking-list-modal')
        };

        function generateFileName() {
            const now = new Date();
            const day = now.getDate().toString().padStart(2, '0');
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const year = now.getFullYear().toString().slice(-2);
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const milliseconds = now.getMilliseconds().toString().padStart(3, '0');
            return `word_search_save_dt_${day}_${month}_${year}_h_${hours}_${minutes}_${seconds}_${milliseconds}.json`;
        }

        function saveGameState(autoSave = false) {
            const gameState = {
                ...state,
                grid: state.grid.map(row => row.map(cell => ({ letter: cell.letter, found: cell.found }))),
                selectedCells: state.selectedCells.map(cell => ({ row: cell.row, col: cell.col }))
            };

            const fileName = generateFileName();
            localStorage.setItem(fileName, JSON.stringify(gameState));
            localStorage.setItem('wordSearchRanking', JSON.stringify(state.ranking));

            const blob = new Blob([JSON.stringify(gameState, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            if (!autoSave) {
                alert('Jogo salvo com sucesso!');
            }
        }

        function initializeGame() {
            state.playerName = '';
            state.level = null;
            state.grid = [];
            state.words = [];
            state.foundWords.clear();
            state.selectedCells = [];
            state.totalTime = 0;
            state.wordTime = 60000;
            state.gameStarted = false;
            state.newWordsCount = 2;
            state.currentMusic = 'musical1'; // Reseta para musical1 ao reiniciar
            if (state.timerInterval) clearInterval(state.timerInterval);
            if (state.wordTimerInterval) clearInterval(state.wordTimerInterval);

            dom.startScreen.style.display = 'block';
            dom.gameScreen.style.display = 'none';
            dom.playerNameInput.value = '';
            dom.startButton.disabled = true;
            dom.newWordsCount.textContent = state.newWordsCount;
            dom.totalTime.textContent = '0.000';
            dom.wordTime.textContent = '60.000';
            dom.wordsDropdown.innerHTML = '';
            dom.grid.innerHTML = '';

            // Reativar botões de dificuldade para permitir nova modalidade
            const difficultyButtons = [dom.easyButton, dom.mediumButton, dom.hardButton, dom.veryHardButton];
            difficultyButtons.forEach(btn => btn.disabled = false);

            // Gerar novas palavras (mantendo as palavras base)
            generateWords();
            updateWordsDropdown();

            const savedRanking = localStorage.getItem('wordSearchRanking');
            if (savedRanking) {
                state.ranking = JSON.parse(savedRanking);
            } else {
                state.ranking = [];
            }
            updateRanking();

            if (state.musicOn) {
                playMusic();
            } else if (state.musicAudio) {
                state.musicAudio.pause();
            }
        }

        function startGame() {
            state.playerName = dom.playerNameInput.value.trim();
            if (!state.playerName) {
                alert('Por favor, insira seu nome.');
                return;
            }

            if (state.soundOn && state.audioUnlocked) playSound(audio.start);
            if (state.musicOn && state.audioUnlocked) {
                state.currentMusic = 'musical1'; // Começa com musical1
                playMusic();
            }

            state.ranking = state.ranking.filter(entry => entry.playerName !== state.playerName);
            state.ranking.push({
                playerName: state.playerName,
                level: state.level || 'Fácil',
                wordsFound: 0,
                totalTime: 0,
                status: 'Em Andamento'
            });
            updateRanking();
            localStorage.setItem('wordSearchRanking', JSON.stringify(state.ranking));

            dom.startScreen.style.display = 'none';
            dom.gameScreen.style.display = 'block';
            dom.playerDisplay.textContent = state.playerName;

            if (!state.level) {
                generateWords();
                updateWordsDropdown();
            }
        }

        function endGame() {
            if (!state.gameStarted) {
                alert('Nenhum jogo em andamento para encerrar.');
                return;
            }

            clearInterval(state.timerInterval);
            clearInterval(state.wordTimerInterval);
            const playerEntry = state.ranking.find(entry => entry.playerName === state.playerName);
            if (playerEntry) {
                playerEntry.wordsFound = state.foundWords.size;
                playerEntry.totalTime = state.totalTime;
                playerEntry.status = 'Desistido';
                updateRanking();
                localStorage.setItem('wordSearchRanking', JSON.stringify(state.ranking));
            }
            alert(`Jogo encerrado, ${state.playerName}! Você encontrou ${state.foundWords.size} palavras em ${formatTime(state.totalTime)}.`);
            initializeGame();
        }

        function setupLevel(level) {
            if (state.gameStarted) {
                alert('Finalize ou reinicie o jogo para mudar o nível.');
                return;
            }

            state.level = level;
            state.gameStarted = true;
            state.grid = [];
            state.foundWords.clear();
            state.selectedCells = [];
            state.totalTime = 0;
            state.wordTime = 60000;

            const levelConfig = config.levels[level];
            generateGrid(levelConfig.gridSize);
            placeWords(levelConfig.gridSize, levelConfig.numWords);
            fillGrid(levelConfig.gridSize);
            renderGrid();
            updateWordsDropdown();
            startTimers();

            const difficultyButtons = [dom.easyButton, dom.mediumButton, dom.hardButton, dom.veryHardButton];
            difficultyButtons.forEach(btn => btn.disabled = true);

            const playerEntry = state.ranking.find(entry => entry.playerName === state.playerName);
            if (playerEntry) {
                playerEntry.level = level.charAt(0).toUpperCase() + level.slice(1);
                playerEntry.status = 'Em Andamento';
                updateRanking();
            }
        }

        function generateWords() {
            let availableWords = [...config.additionalWords];
            state.words = [...config.baseWords];
            const numAdditionalWords = config.levels[state.level || 'easy'].numWords - config.baseWords.length;
            for (let i = 0; i < numAdditionalWords; i++) {
                const idx = Math.floor(Math.random() * availableWords.length);
                state.words.push(availableWords[idx]);
                availableWords.splice(idx, 1);
            }
        }

        function generateGrid(size) {
            for (let i = 0; i < size; i++) {
                const row = [];
                for (let j = 0; j < size; j++) {
                    row.push({ letter: '', found: false });
                }
                state.grid.push(row);
            }
        }

        function placeWords(size, numWords) {
            const directions = [
                [0, 1], [1, 0], [1, 1], [-1, -1], [0, -1], [-1, 0], [-1, 1], [1, -1]
            ];

            state.words.forEach(word => {
                let placed = false;
                let attempts = 0;
                while (!placed && attempts < 100) {
                    const dir = directions[Math.floor(Math.random() * directions.length)];
                    const row = Math.floor(Math.random() * size);
                    const col = Math.floor(Math.random() * size);
                    if (canPlaceWord(word, row, col, dir[0], dir[1], size)) {
                        placeWord(word, row, col, dir[0], dir[1]);
                        placed = true;
                    }
                    attempts++;
                }
            });
        }

        function canPlaceWord(word, row, col, dRow, dCol, size) {
            for (let i = 0; i < word.length; i++) {
                const r = row + i * dRow;
                const c = col + i * dCol;
                if (r < 0 || r >= size || c < 0 || c >= size) return false;
                if (state.grid[r][c].letter && state.grid[r][c].letter !== word[i]) return false;
            }
            return true;
        }

        function placeWord(word, row, col, dRow, dCol) {
            for (let i = 0; i < word.length; i++) {
                const r = row + i * dRow;
                const c = col + i * dCol;
                state.grid[r][c].letter = word[i];
            }
        }

        function fillGrid(size) {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (!state.grid[i][j].letter) {
                        state.grid[i][j].letter = letters.charAt(Math.floor(Math.random() * letters.length));
                    }
                }
            }
        }

        function renderGrid() {
            const size = config.levels[state.level].gridSize;
            dom.grid.style.gridTemplateColumns = `repeat(${size}, 30px)`;
            dom.grid.style.gridTemplateRows = `repeat(${size}, 30px)`;
            dom.grid.innerHTML = '';

            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.textContent = state.grid[i][j].letter;
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    if (state.grid[i][j].found) cell.classList.add('found');
                    cell.addEventListener('click', handleCellClick);
                    cell.addEventListener('mouseover', () => {
                        if (state.soundOn && state.audioUnlocked) playSound(audio.hover);
                    });
                    dom.grid.appendChild(cell);
                }
            }
        }

        function handleCellClick(event) {
            if (!state.gameStarted || !state.level) {
                alert('Por favor, escolha um nível de dificuldade para começar o jogo.');
                return;
            }

            const row = parseInt(event.target.dataset.row);
            const col = parseInt(event.target.dataset.col);

            if (state.selectedCells.some(cell => cell.row === row && cell.col === col)) {
                state.selectedCells = state.selectedCells.filter(cell => !(cell.row === row && cell.col === col));
            } else if (state.selectedCells.length < 2) {
                state.selectedCells.push({ row, col });
                if (state.soundOn && state.audioUnlocked) playSound(audio.click);
            }

            updateSelectedCells();

            if (state.selectedCells.length === 2) {
                checkWord();
            }
        }

        function updateSelectedCells() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            state.selectedCells.forEach(cell => {
                const cellElement = document.querySelector(`.cell[data-row="${cell.row}"][data-col="${cell.col}"]`);
                if (cellElement) cellElement.classList.add('selected');
            });
        }

        function checkWord() {
            if (state.selectedCells.length !== 2) return;

            const [cell1, cell2] = state.selectedCells;
            const word = extractWord(cell1, cell2);
            const reversedWord = word.split('').reverse().join('');

            let found = false;
            if (state.words.includes(word) && !state.foundWords.has(word)) {
                state.foundWords.add(word);
                found = true;
            } else if (state.words.includes(reversedWord) && !state.foundWords.has(reversedWord)) {
                state.foundWords.add(reversedWord);
                found = true;
            }

            if (found) {
                markWord(cell1, cell2);
                state.wordTime = 60000;
                if (state.soundOn && state.audioUnlocked) playSound(audio.success); // Toca aplausos

                const playerEntry = state.ranking.find(entry => entry.playerName === state.playerName);
                if (playerEntry) {
                    playerEntry.wordsFound = state.foundWords.size;
                    updateRanking();
                }

                if (state.foundWords.size === state.words.length) {
                    if (state.soundOn && state.audioUnlocked) playSound(audio.win);
                    clearInterval(state.timerInterval);
                    clearInterval(state.wordTimerInterval);
                    const playerEntry = state.ranking.find(entry => entry.playerName === state.playerName);
                    if (playerEntry) {
                        playerEntry.status = 'Concluído';
                        updateRanking();
                    }
                    saveGameState(true);
                    alert(`Parabéns, ${state.playerName}! Você encontrou todas as palavras em ${formatTime(state.totalTime)}!`);
                    localStorage.setItem('wordSearchRanking', JSON.stringify(state.ranking));
                    initializeGame(); // Reseta o jogo e permite nova modalidade
                }
            } else {
                if (state.soundOn && state.audioUnlocked) playSound(audio.error);
            }

            state.selectedCells = [];
            updateSelectedCells();
            updateWordsDropdown();
        }

        function extractWord(cell1, cell2) {
            const row1 = cell1.row, col1 = cell1.col;
            const row2 = cell2.row, col2 = cell2.col;
            let word = '';

            if (row1 === row2) {
                const start = Math.min(col1, col2);
                const end = Math.max(col1, col2);
                for (let c = start; c <= end; c++) {
                    word += state.grid[row1][c].letter;
                }
            } else if (col1 === col2) {
                const start = Math.min(row1, row2);
                const end = Math.max(row1, row2);
                for (let r = start; r <= end; r++) {
                    word += state.grid[r][col1].letter;
                }
            } else if (Math.abs(row2 - row1) === Math.abs(col2 - col1)) {
                const steps = Math.abs(row2 - row1);
                const rowStep = row2 > row1 ? 1 : -1;
                const colStep = col2 > col1 ? 1 : -1;
                for (let i = 0; i <= steps; i++) {
                    const r = row1 + i * rowStep;
                    const c = col1 + i * colStep;
                    word += state.grid[r][c].letter;
                }
            }

            return word;
        }

        function markWord(cell1, cell2) {
            const row1 = cell1.row, col1 = cell1.col;
            const row2 = cell2.row, col2 = cell2.col;

            if (row1 === row2) {
                const start = Math.min(col1, col2);
                const end = Math.max(col1, col2);
                for (let c = start; c <= end; c++) {
                    state.grid[row1][c].found = true;
                    const cellElement = document.querySelector(`.cell[data-row="${row1}"][data-col="${c}"]`);
                    if (cellElement) cellElement.classList.add('found');
                }
            } else if (col1 === col2) {
                const start = Math.min(row1, row2);
                const end = Math.max(row1, row2);
                for (let r = start; r <= end; r++) {
                    state.grid[r][col1].found = true;
                    const cellElement = document.querySelector(`.cell[data-row="${r}"][data-col="${col1}"]`);
                    if (cellElement) cellElement.classList.add('found');
                }
            } else if (Math.abs(row2 - row1) === Math.abs(col2 - col1)) {
                const steps = Math.abs(row2 - row1);
                const rowStep = row2 > row1 ? 1 : -1;
                const colStep = col2 > col1 ? 1 : -1;
                for (let i = 0; i <= steps; i++) {
                    const r = row1 + i * rowStep;
                    const c = col1 + i * colStep;
                    state.grid[r][c].found = true;
                    const cellElement = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
                    if (cellElement) cellElement.classList.add('found');
                }
            }
        }

        function updateWordsDropdown() {
            dom.wordsDropdown.innerHTML = '';
            state.words.forEach(word => {
                const option = document.createElement('option');
                option.textContent = state.foundWords.has(word) ? `~~${word}~~` : word;
                option.disabled = true;
                dom.wordsDropdown.appendChild(option);
            });
        }

        function startTimers() {
            if (state.timerInterval) clearInterval(state.timerInterval);
            if (state.wordTimerInterval) clearInterval(state.wordTimerInterval);

            state.timerInterval = setInterval(() => {
                state.totalTime += 10;
                dom.totalTime.textContent = formatTime(state.totalTime);

                const playerEntry = state.ranking.find(entry => entry.playerName === state.playerName);
                if (playerEntry) {
                    playerEntry.totalTime = state.totalTime;
                    updateRanking();
                }
            }, 10);

            state.wordTimerInterval = setInterval(() => {
                state.wordTime -= 10;
                dom.wordTime.textContent = formatTime(state.wordTime);
                if (state.wordTime <= 0) {
                    clearInterval(state.timerInterval);
                    clearInterval(state.wordTimerInterval);
                    if (state.soundOn && state.audioUnlocked) playSound(audio.gameOver);
                    const playerEntry = state.ranking.find(entry => entry.playerName === state.playerName);
                    if (playerEntry) {
                        playerEntry.status = 'Derrota';
                        updateRanking();
                    }
                    saveGameState(true);
                    alert('Game Over! O tempo para encontrar a próxima palavra acabou. Clique em "Reiniciar Jogo" para tentar novamente.');
                    initializeGame(); // Reseta e permite nova modalidade
                }
            }, 10);
        }

        function formatTime(milliseconds) {
            const seconds = Math.floor(milliseconds / 1000);
            const millis = milliseconds % 1000;
            return `${seconds.toString().padStart(2, '0')}.${millis.toString().padStart(3, '0')}`;
        }

        function toggleZoom() {
            const isZoomEnabled = document.querySelector('meta[name="viewport"]').content.includes('user-scalable=yes');
            if (isZoomEnabled) {
                document.querySelector('meta[name="viewport"]').content = 'width=device-width, initial-scale=1.0, user-scalable=no';
                dom.zoomToggle.textContent = 'Ativar Zoom';
            } else {
                document.querySelector('meta[name="viewport"]').content = 'width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.5, maximum-scale=3.0';
                dom.zoomToggle.textContent = 'Desativar Zoom';
            }
        }

        function generateNewWords() {
            if (state.gameStarted) {
                alert('Finalize ou reinicie o jogo para gerar novas palavras.');
                return;
            }
            if (state.newWordsCount <= 0) {
                alert('Você já usou todas as tentativas para gerar novas palavras.');
                return;
            }
            state.newWordsCount--;
            dom.newWordsCount.textContent = state.newWordsCount;
            generateWords();
            updateWordsDropdown();
        }

        function updateRanking() {
            const sortedRanking = [...state.ranking]
                .sort((a, b) => {
                    if (a.wordsFound !== b.wordsFound) return b.wordsFound - a.wordsFound;
                    return a.totalTime - b.totalTime;
                })
                .slice(0, 10);

            [dom.rankingListGame, dom.rankingListModal].forEach(list => {
                list.innerHTML = '';
                sortedRanking.forEach((entry, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${entry.playerName}</td>
                        <td>${entry.level}</td>
                        <td>${entry.wordsFound}</td>
                        <td>${formatTime(entry.totalTime)}</td>
                        <td>${entry.status}</td>
                    `;
                    list.appendChild(tr);
                });
            });
        }

        function showRankingModal() {
            dom.rankingModal.style.display = 'flex';
        }

        function closeRankingModal() {
            dom.rankingModal.style.display = 'none';
        }

        function toggleMusic() {
            state.musicOn = !state.musicOn;
            const buttons = [dom.musicToggle, dom.musicToggleGame];
            buttons.forEach(btn => {
                btn.classList.toggle('on', state.musicOn);
                btn.classList.toggle('off', !state.musicOn);
                const icon = btn.querySelector('i');
                icon.classList.toggle('fa-volume-up', state.musicOn);
                icon.classList.toggle('fa-volume-mute', !state.musicOn);
            });

            if (state.musicOn) {
                playMusic();
            } else if (state.musicAudio) {
                state.musicAudio.pause();
            }
        }

        function toggleSound() {
            state.soundOn = !state.soundOn;
            dom.soundToggle.classList.toggle('on', state.soundOn);
            dom.soundToggle.classList.toggle('off', !state.soundOn);
        }

        function playSound(sound) {
            if (!state.soundOn || !state.audioUnlocked) return;
            sound.currentTime = 0;
            try {
                const playPromise = sound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(err => console.warn('Falha ao tocar som:', err));
                }
            } catch (err) {
                console.warn('Erro ao tentar tocar som:', err);
            }
        }

        function playMusic() {
            if (!state.audioUnlocked) {
                console.warn('Áudio ainda não desbloqueado. Interaja com a página primeiro.');
                return;
            }
            if (state.musicOn) {
                if (state.musicAudio) {
                    state.musicAudio.pause();
                    state.musicAudio.currentTime = 0;
                }
                const musicFile = state.currentMusic === 'musical1' ? config.music.musical1 : config.music.musical2;
                state.musicAudio = new Audio(musicFile);
                state.musicAudio.volume = 0.5;
                state.musicAudio.loop = false; // Desativa o loop para permitir a troca
                try {
                    state.musicAudio.play().catch(err => console.warn('Erro ao tocar música:', err));
                } catch (err) {
                    console.warn('Erro ao tentar tocar música:', err);
                }

                // Quando a música terminar, alternar para a próxima
                state.musicAudio.addEventListener('ended', () => {
                    state.currentMusic = state.currentMusic === 'musical1' ? 'musical2' : 'musical1';
                    playMusic(); // Toca a próxima música
                }, { once: true });
            }
        }

        function unlockAudio() {
            if (state.audioUnlocked) return;
            state.audioUnlocked = true;
            const silentSound = new Audio();
            silentSound.volume = 0;
            silentSound.play().catch(() => {});
            if (state.musicOn) playMusic();
        }

        function addButtonSoundEvents(button) {
            button.addEventListener('mouseover', () => {
                if (state.soundOn && state.audioUnlocked) playSound(audio.hover);
            });
            button.addEventListener('click', () => {
                if (state.soundOn && state.audioUnlocked) playSound(audio.click);
            });
        }

        function saveGame() {
            if (!state.gameStarted) {
                alert('Inicie o jogo antes de salvar.');
                return;
            }
            saveGameState();
        }

        function triggerLoadGame() {
            if (state.gameStarted && !confirm('Um jogo está em andamento. Deseja carregar um jogo salvo e perder o progresso atual?')) {
                return;
            }
            dom.loadFileInput.click();
        }

        function loadGame(event) {
            const file = event.target.files[0];
            if (!file) {
                alert('Nenhum arquivo selecionado.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const gameState = JSON.parse(e.target.result);
                    loadGameState(gameState);
                    alert('Jogo carregado com sucesso!');
                } catch (err) {
                    console.error('Erro ao carregar arquivo:', err);
                    alert('Erro ao carregar o arquivo. Iniciando novo jogo.');
                    initializeGame();
                }
            };
            reader.readAsText(file);
            dom.loadFileInput.value = '';
        }

        function loadGameState(gameState) {
            Object.assign(state, gameState);
            state.foundWords = new Set(gameState.foundWords);
            state.grid = gameState.grid.map(row => row.map(cell => ({ letter: cell.letter, found: cell.found })));
            state.selectedCells = gameState.selectedCells.map(cell => ({ row: cell.row, col: cell.col }));

            dom.startScreen.style.display = 'none';
            dom.gameScreen.style.display = 'block';
            dom.playerDisplay.textContent = state.playerName;
            dom.totalTime.textContent = formatTime(state.totalTime);
            dom.wordTime.textContent = formatTime(state.wordTime);
            dom.newWordsCount.textContent = state.newWordsCount;

            const difficultyButtons = [dom.easyButton, dom.mediumButton, dom.hardButton, dom.veryHardButton];
            difficultyButtons.forEach(btn => btn.disabled = state.gameStarted);

            renderGrid();
            updateWordsDropdown();
            updateSelectedCells();
            if (state.gameStarted) startTimers();

            state.ranking = state.ranking.filter(entry => entry.playerName !== state.playerName);
            state.ranking.push({
                playerName: state.playerName,
                level: state.level.charAt(0).toUpperCase() + state.level.slice(1),
                wordsFound: state.foundWords.size,
                totalTime: state.totalTime,
                status: 'Em Andamento'
            });
            updateRanking();
            localStorage.setItem('wordSearchRanking', JSON.stringify(state.ranking));

            dom.musicToggle.classList.toggle('on', state.musicOn);
            dom.musicToggle.classList.toggle('off', !state.musicOn);
            dom.musicToggleGame.classList.toggle('on', state.musicOn);
            dom.musicToggleGame.classList.toggle('off', !state.musicOn);
            dom.soundToggle.classList.toggle('on', state.soundOn);
            dom.soundToggle.classList.toggle('off', !state.soundOn);

            if (state.musicOn) playMusic();
        }

        function submitContact() {
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const message = document.getElementById('contact-message').value;
            if (name && email && message) {
                alert('Mensagem enviada com sucesso! Entraremos em contato em breve.');
                document.getElementById('contact-name').value = '';
                document.getElementById('contact-email').value = '';
                document.getElementById('contact-message').value = '';
            } else {
                alert('Por favor, preencha todos os campos.');
            }
        }

        function openTab(evt, tabName) {
            document.querySelectorAll('.tabs > .tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            evt.currentTarget.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeGame();

            dom.playerNameInput.addEventListener('input', () => {
                state.playerName = dom.playerNameInput.value.trim();
                dom.startButton.disabled = !state.playerName;
                if (state.soundOn && state.audioUnlocked) playSound(audio.type);
            });

            dom.startButton.addEventListener('click', startGame);
            dom.endGameButton.addEventListener('click', endGame);
            dom.easyButton.addEventListener('click', () => setupLevel('easy'));
            dom.mediumButton.addEventListener('click', () => setupLevel('medium'));
            dom.hardButton.addEventListener('click', () => setupLevel('hard'));
            dom.veryHardButton.addEventListener('click', () => setupLevel('veryHard'));

            dom.restartButton.addEventListener('click', () => {
                if (state.gameStarted && !confirm('Deseja reiniciar o jogo? Todo o progresso atual será perdido.')) {
                    return;
                }
                const playerEntry = state.ranking.find(entry => entry.playerName === state.playerName);
                if (playerEntry && playerEntry.status === 'Em Andamento') {
                    playerEntry.status = 'Desistido';
                    updateRanking();
                    localStorage.setItem('wordSearchRanking', JSON.stringify(state.ranking));
                }
                initializeGame();
            });

            dom.newWordsButton.addEventListener('click', generateNewWords);
            dom.musicToggle.addEventListener('click', toggleMusic);
            dom.musicToggleGame.addEventListener('click', toggleMusic);
            dom.soundToggle.addEventListener('click', toggleSound);
            dom.zoomToggle.addEventListener('click', toggleZoom);
            dom.rankingButton.addEventListener('click', showRankingModal);
            dom.loadGameButton.addEventListener('click', triggerLoadGame);
            dom.loadGameButtonGame.addEventListener('click', triggerLoadGame);
            dom.saveGameButton.addEventListener('click', saveGame);

            const buttons = [
                dom.startButton, dom.musicToggle, dom.musicToggleGame, dom.soundToggle,
                dom.loadGameButton, dom.rankingButton, dom.restartButton, dom.endGameButton,
                dom.newWordsButton, dom.easyButton, dom.mediumButton, dom.hardButton,
                dom.veryHardButton, dom.saveGameButton, dom.loadGameButtonGame, dom.zoomToggle
            ];
            buttons.forEach(addButtonSoundEvents);

            document.addEventListener('click', unlockAudio, { once: true });

            if (/Mobi|Android/i.test(navigator.userAgent)) {
                dom.zoomToggle.style.display = 'block';
            } else {
                dom.zoomToggle.style.display = 'none';
            }
        });
    </script>
</body>
</html>